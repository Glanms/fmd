{"name":"Fmd","tagline":"Douban FM Daemon (inspired by Music Player Daemon)","body":"# FMD (Douban FM Daemon)\r\n\r\nFMD stands for Douban FM Daemon, inspired by MPD (Music Player Daemon). FMD plays music from Douban FM in background and communicate with clients through TCP connections.\r\n\r\n## Config\r\n\r\nThe main config file is `~/.fmd/fmd.conf`. Config file includes several sections.\r\n\r\nIn `DoubanFM` section, there are the following config items:\r\n\r\n\tchannel [int]   # Douban FM Channel id\r\n\tuid [string]    # Douban FM user id\r\n    uname [string]  # Douban FM user name\r\n\ttoken [string]  # Douban FM authorization token\r\n\texpire [string] # token expire time\r\n\r\nTo get a complete channel list, try:\r\n\r\n\twget -q -O - \"http://www.douban.com/j/app/radio/channels\" | json_pp\r\n\r\nTo get your own `uid`, `uname`, `token` and `expire`, try:\r\n\r\n\twget -q -O - --post-data=\"email=[email]&password=[passwd]&app_name=radio_desktop_win&version=100\" \"http://www.douban.com/j/app/login\"\r\n\r\nReplace `[email]` and `[passwd]` with your douban account and password.\r\n\r\nIn `Output` section, there are the following config items:\r\n\r\n    driver [string] # audio output driver, default is \"alsa\"\r\n    device [string] # audio output device, can be omitted\r\n    rate [int]      # audio ouput rate, default to 44100\r\n\r\nAs FMD uses [libao](http://xiph.org/ao) for audio output, users may found it useful to refer to [libao's driver document](http://www.xiph.org/ao/doc/drivers.html) when deciding which driver to use. For example, users of PulseAudio should change the `Output` section to:\r\n\r\n    [Output]\r\n    driver = pulse\r\n    device = 0\r\n    rate = 44100\r\n\r\nAnd for Mac users:\r\n\r\n    [Output]\r\n    driver = macosx\r\n    device =\r\n    rate = 44100\r\n\r\nIn `Server` section, there are the following config items:\r\n\r\n    address [string]# server listen address, default to \"localhost\"\r\n    port [int]      # server listen port, default to 10098\r\n\r\nPlease create a config file before using FMD. A sample config file is:\r\n\r\n    [DoubanFM]\r\n    channel = 0\r\n    uid = 123456\r\n    uname = username\r\n    token = 1234abcd\r\n    expire = 1345000000\r\n\r\n    [Output]\r\n    driver = alsa\r\n    device = default\r\n    rate = 44100\r\n\r\n    [Server]\r\n    address = localhost\r\n    port = 10098\r\n\r\n## Commands\r\n\r\nThe communication between FMD and clients go throught TCP connection.\r\n\r\nCommands client can send are `play`, `stop`, `pause`, `toggle`, `skip`, `ban`, `rate`, `unrate`, `info` and `end`.\r\n\r\n* `play`: start playing\r\n* `stop`: stop playing, and set play position to 0:00\r\n* `pause`: stop playing\r\n* `toggle`: toggle between playing and pause\r\n* `skip`: skip current song\r\n* `ban`: mark current song as \"dislike\"\r\n* `rate`: mark current song as \"like\"\r\n* `unrate`: unmark current song\r\n* `info`: simply get FMD info\r\n* `end`: tell FMD to exit\r\n\r\n**Note**: The recommand way to exit FMD is `killall fmd`. Because the `end` command must be sent from the client and will left the FMD port in wait-close for several minutes, during which time new FMD instance cannot bind to the port.\r\n\r\n## Protocol\r\n\r\nFMD responses to all commands except `end`, the reponse is a json string containing current FMD infomation.\r\n\r\n    {\r\n       \"len\" : 0,\r\n       \"sid\" : 967698,\r\n       \"status\" : \"play\",\r\n       \"channel\" : 0,\r\n       \"like\" : 0,\r\n       \"artist\" : \"花儿乐队\",\r\n       \"album\" : \"幸福的旁边\",\r\n       \"cover\" : \"http://img1.douban.com/mpic/s4433542.jpg\",\r\n       \"url\" : \"/subject/1404476/\",\r\n       \"user\" : \"小强\",\r\n       \"pos\" : 5,\r\n       \"title\" : \"别骗我\",\r\n       \"year\" : 1999\r\n    }\r\n\r\nThe simplest FMD client is telnet:\r\n\r\n    telnet localhost 10098\r\n    Trying ::1...\r\n    Connection failed: Connection refused\r\n    Trying 127.0.0.1...\r\n    Connected to localhost.\r\n    Escape character is '^]'.\r\n    info\r\n    {\"status\":\"play\",\"channel\":0,\"user\":\"小强\",\"title\":\"What's My Name (Intro #1)\",\"artist\":\"Rihanna / Drake\", \"album\":\"Promo Only Rhythm...\",\"year\":2010,\"cover\":\"http://img1.douban.com/mpic/s4615061.jpg\",\"url\":\"/subject/5951920/\",\"sid\":1561924,\"like\":0,\"pos\":107,\"len\":254}\r\n    toggle\r\n    {\"status\":\"pause\",\"channel\":0,\"user\":\"小强\",\"title\":\"What's My Name (Intro #1)\",\"artist\":\"Rihanna / Drake\", \"album\":\"Promo Only Rhythm...\",\"year\":2010,\"cover\":\"http://img1.douban.com/mpic/s4615061.jpg\",\"url\":\"/subject/5951920/\",\"sid\":1561924,\"like\":0,\"pos\":111,\"len\":254}\r\n    toggle\r\n    {\"status\":\"play\",\"channel\":0,\"user\":\"小强\",\"title\":\"What's My Name (Intro #1)\",\"artist\":\"Rihanna / Drake\", \"album\":\"Promo Only Rhythm...\",\"year\":2010,\"cover\":\"http://img1.douban.com/mpic/s4615061.jpg\",\"url\":\"/subject/5951920/\",\"sid\":1561924,\"like\":0,\"pos\":111,\"len\":254}\r\n    help\r\n    {\"status\":\"error\",\"message\":\"wrong command: help\"}\r\n\r\n[FMC](https://github.com/hzqtc/fmc) is a command line client for FMD.\r\n\r\n## Install\r\n\r\nFMD is written in C and depends on `libcurl` (for api calls and music downloading), `json-c` (for API parsing), `mpg123` (for music decoding) and `libao` (for music playing).\r\n\r\nCurrently, there is no binary distribution for this project. So compile from source is the only option. FMD has been tested on Linux and Mac OS X 10.7.\r\n\r\n    git clone https://github.com/hzqtc/fmd.git\r\n    cd fmd\r\n    make release\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}